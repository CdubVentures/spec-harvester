flowchart TD
  A["User updates component key and value\nPOST review-components category component-override"] --> B{"Property type"}
  B -->|Standard property| C["Upsert component_values\ncomponent_type + component_name + maker + property_key\nvalue + variance_policy + constraints + source + accepted_candidate_id"]
  B -->|Identity name or maker| D["Update component_identity\nUpdate component_values identity refs\nUpdate item_component_links identity refs"]

  C --> E["applySharedLaneState\ntarget_kind component_key"]
  D --> E

  E --> F["cascadeComponentChange"]
  F --> G["findProductsReferencingComponent"]
  G --> G1["item_component_links linked matches"]
  G --> G2["item_field_state and normalized fallback discovery"]

  F --> H{"effective policy"}
  H -->|authoritative| I["pushAuthoritativeValueToLinkedProducts\nlinked items only"]
  I --> I1["Update item_field_state value\nfield_key changedProperty"]
  I --> I2["Update latest normalized field and specs\nlinked items only"]

  H -->|upper_bound lower_bound range| J["evaluateAndFlagLinkedProducts\nlinked items only"]
  J --> J1["Set or clear needs_ai_review"]

  F --> K{"constraints present"}
  K -->|yes| L["evaluateConstraintsForLinkedProducts\nmaker scoped component values\nlinked items only"]
  L --> L1["Set or clear needs_ai_review"]

  I --> M["Mark queue stale and dirty_flags\nreason component_change"]
  J --> M
  L --> M

  E --> N["Candidate source handling\nItem evidence remains item scoped\nAuthoritative propagation updates values and flags only"]
  O["source_host/source_root_domain\nmetadata only"] -. not an authority key .-> E
