flowchart TD
  A["Enum master action\nPOST enum-override or enum-rename"] --> B{"Action"}

  B -->|add accept confirm| C["upsertListValue\nlist_values master row"]
  B -->|accept with oldValue| D["renameListValue atomic\nrewrite item_field_state value\nremap item_list_links list_value_id"]
  B -->|remove| E["deleteListValue\nremove dependent item_list_links first"]

  C --> F["applySharedLaneState\ntarget_kind enum_key"]
  D --> F

  D --> G["cascadeEnumChange rename"]
  E --> H["cascadeEnumChange remove"]
  G --> I["Mark affected items stale and dirty_flags"]
  H --> I

  J["Item writes\nreview override manual override finalize exporter"] --> K["syncItemListLinkForFieldValue"]
  K --> K1["resolve field value to list_values id\nexact then normalized case insensitive"]
  K --> K2["upsert or remove item_list_links"]

  K -. item does not mutate enum master .-> C
  F --> L["enum_key shared decision\nunique by field and enum_value_norm"]
